<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analytics Dashboard - Astraea Scouting</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo2.png') }}">
  <link rel="stylesheet" href="/static/analytics.css">
</head>
<body>
  <div class="dashboard-container">
    <div class="header">
      <div class="header-left">
        <h1>📊 Scouting Analytics Dashboard</h1>
        <p class="header-subtitle">Comprehensive analysis of team performance and match data</p>
      </div>
      <div class="header-right">
        <a href="/admin" class="back-btn">← Back to Admin</a>
        <button class="refresh-btn" onclick="loadAnalyticsData()">🔄 Refresh Data</button>
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
          <label for="event-filter">Event:</label>
          <select id="event-filter">
            <option value="">All Events</option>
          </select>
      </div>
      <div class="control-group">
          <label for="team-filter">Team:</label>
          <select id="team-filter">
            <option value="">All Teams</option>
          </select>
      </div>
      <div class="control-group">
          <label for="match-filter">Match Range:</label>
          <input type="number" id="match-min" placeholder="Min" min="1" style="width: 80px;">
          <span style="color: rgba(255, 255, 255, 0.9);">-</span>
          <input type="number" id="match-max" placeholder="Max" min="1" style="width: 80px;">
      </div>
      <div class="control-group">
          <label>
            <input type="checkbox" id="hide-partial-filter">
            Hide Partial Matches
          </label>
      </div>
    </div>

    <div class="analytics-tabs">
      <button class="tab-btn active" data-tab="overview">📈 Overview</button>
      <button class="tab-btn" data-tab="teams">🤖 Team Analysis</button>
      <button class="tab-btn" data-tab="matches">🏟 Match Details</button>
      <button class="tab-btn" data-tab="insights">🧠 Team Insights</button>
      <button class="tab-btn" data-tab="comparison">⚖️ Team Comparison</button>
    </div>

    <!-- Overview Tab -->
    <div id="overview" class="tab-content active">
      <div class="stats-grid" id="overview-stats">
        <div class="stat-card">
          <span class="stat-number" id="total-reports">-</span>
          <span class="stat-label">Total Reports</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="total-teams">-</span>
          <span class="stat-label">Teams Scouted</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="avg-auto-score">-</span>
          <span class="stat-label">Avg Auto Score</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="avg-teleop-score">-</span>
          <span class="stat-label">Avg Teleop Score</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="climb-success-rate">-</span>
          <span class="stat-label">Climb Success Rate</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="avg-offense-rating">-</span>
          <span class="stat-label">Avg Offense Rating</span>
        </div>
      </div>

      <div class="chart-container">
        <h3 class="chart-title">🎯 Scoring Distribution</h3>
        <canvas id="scoring-chart" width="400" height="200"></canvas>
      </div>

      <div class="chart-container">
        <h3 class="chart-title">🏆 Top Performing Teams</h3>
        <div id="top-teams-chart"></div>
      </div>
    </div>

    <!-- Team Analysis Tab -->
    <div id="teams" class="tab-content">
      <div class="chart-container">
        <h3 class="chart-title">🤖 Team Performance Analysis</h3>
        <div id="team-analysis-container">
          <div class="loading">Loading team data...</div>
        </div>
      </div>
    </div>

    <!-- Match Details Tab -->
    <div id="matches" class="tab-content">
      <div class="chart-container">
        <h3 class="chart-title">🏟 Recent Match Details</h3>
        <div id="match-details-container">
          <div class="loading">Loading match data...</div>
        </div>
      </div>
    </div>

    <!-- Team Insights Tab -->
    <div id="insights" class="tab-content">
      <div class="chart-container">
        <h3 class="chart-title">🧠 AI-Generated Team Insights</h3>
        <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
          Advanced AI analysis of team performance patterns, consistency, strategic focus, and competitive insights based on match data.
        </p>
        
        <!-- Updated AI Controls -->
        <div class="ai-controls" style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #e2e8f0;">
          <h4 style="margin: 0 0 12px 0; color: #1e40af;">🤖 AI-Powered Team Analysis</h4>
          <p style="margin: 0 0 16px 0; color: #64748b; font-size: 0.95rem;">
            Select a team to generate comprehensive AI insights including strengths, weaknesses, trends, and strategic recommendations.
          </p>
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <select id="ai-team-select" style="flex: 1; min-width: 200px; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
              <option value="">Select Team for AI Analysis</option>
            </select>
            <button 
              class="ai-generate-btn" 
              onclick="const team = document.getElementById('ai-team-select').value; if(team) generateGeminiInsight(team); else alert('Please select a team first');"
              style="padding: 8px 16px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; white-space: nowrap; transition: all 0.2s ease;">
              🔮 Generate AI Insight
            </button>
          </div>
          <div style="margin-top: 12px; padding: 8px; background: #fef3c7; border-radius: 4px; font-size: 0.85rem; color: #92400e;">
            ⚠️ <strong>Usage Note:</strong> AI insights consume API credits. Use thoughtfully for strategic analysis.
          </div>
        </div>

        <!-- Results Container -->
        <div id="team-insights-container">
          <div style="text-align: center; padding: 40px; color: #9ca3af;">
            <div style="font-size: 3rem; margin-bottom: 16px;">🤖</div>
            <p style="margin: 0; font-size: 1.1rem; color: #374151;">Select a team above to generate AI-powered insights</p>
            <p style="margin: 8px 0 0 0; font-size: 0.9rem;">Advanced analysis includes performance trends, strategic recommendations, and competitive insights</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Team Comparison Tab -->
    <div id="comparison" class="tab-content">
      <div class="controls">
        <div class="control-group">
          <label for="compare-team1">Team 1:</label>
          <select id="compare-team1">
            <option value="">Select Team</option>
          </select>
        </div>
        <div class="control-group">
          <label for="compare-team2">Team 2:</label>
          <select id="compare-team2">
            <option value="">Select Team</option>
          </select>
        </div>
        <button class="refresh-btn" onclick="compareTeams()">🔍 Compare</button>
      </div>

      <div class="chart-container">
        <h3 class="chart-title">⚖️ Head-to-Head Comparison</h3>
        <div id="comparison-container">
          <p class="loading">Select two teams to compare their performance</p>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/analytics.js"></script>
</body>
</html>
